# ansible-8.3

### Что делает playbook

Плейбук разветывает на каждом из трёх хостов по одному из приложению, за исключением nginx который развёртывается на двух хостах:
- clickhouse
- lighthouse
- vector
- nginx *

Первоначальное развёртывание хостов производится при помощи terraform.
После развёртывания хостов возможно потребуется доустановить некоторые приложения, например в случае с centos-8/centos-stream-8 это firewalld (не установлен в базовом образе YandexCloud)

* дополнительно развёртывается nginx на хостах lighthouse и vector

Clickhouse, Vector  развёртываются из пакетов `rpm`, Lighthouse из репозитория GitHub, Nginx из epel-репозитория.

### Какие у него есть параметры 

- IP хостов нужно задать в файле инвентаризации [prod.yml](src/ansible/inventory/prod.yml) и/или [stage.yml](src/ansible/inventory/stage.yml) 
- `ClickHouse` и `vector` устанавливаются как сервисы, 
- `lighthouse` развёртывается в `/opt/lighthouse` обращение идёт через веб-сервер `nginx`

### Какие у него есть теги

- tags: clickhouse
- tags: vector
- tags: nginx
- tags: lighthouse
- tags: [drop_clickhouse_database_logs, never] - данный play не будет исполнен

### замечания по результатам выполнения playbook на разных образах

1. перед выполнением playbook на хостах созданных из разных образов есть необходимость донастройки/доустановки отдельных пакетов

    например для образа CentOS Stream 8 из Yandex Cloud потребовалось доустановить firewalld для корректной работы плэйбука. либо закоментировать соответсвующие куски плэйбуков по работе с firewalld

1. для работы приложений на хосте с несколькими сетевыми интерфейсами необходимо предварительно изменить listen_host который предполагается использовать.